<launch>

	<arg name="mav_name" default="$(env ROS_NAMESPACE)"/>

	<arg name="launch_joy" default="false"/>
	<arg name="launch_mocap" default="false"/>
	<arg name="launch_drone_pose" default="true"/>
	<arg name="launch_mavros" default="false"/>
	
	<arg name="world_frame" default="$(arg mav_name)/odom"/>
	<arg name="base_frame" default="$(arg mav_name)/base_link"/>
	
	<!-- .................................................... -->
	
	<node if="$(arg launch_joy)" name="joy_node" pkg="joy" type="joy_node" output="screen"/>
	
	<!-- .................................................... -->
	
	<include if="$(arg launch_mocap)" file="$(find vrpn_client_ros)/launch/sample.launch" />
	
	<!-- .................................................... -->

	<node if="$(arg launch_drone_pose)" name="drone_pose" pkg="drone_pose" type="drone_pose_node" output="screen">
		<remap from="drone_pose/mavros_state_in" to="mavros/state"/>
		<remap from="drone_pose/joy_in" to="/joy"/>
		<remap from="drone_pose/pose_in" to="/A01/mavros/local_position/pose"/>
		<remap from="drone_pose/estop_status_in" to ="drone_pose/estop_status_in"/>
		<remap from="drone_pose/mavros_extended_state_in" to="mavros/extended_state"/>
		<remap from="drone_pose/battery_status_in" to="mavros/battery"/>
		<remap from="drone_pose/landing_safety_in" to="drone_pose/landing_safety_in"/>
		<remap from="drone_pose/traj_set_in" to="drone_pose/traj_set_in"/>
		<remap from="drone_pose/twist_set_in" to="drone_pose/twist_set_in"/>
		<remap from="drone_pose/mavros_setpoint_out" to="command/pose"/>
		<remap from="drone_pose/attractor_setpoint_out" to="drone_pose/attractor_setpoint_out"/>
		<remap from="drone_pose/estop_command_out" to="drone_pose/estop_command_out"/>
		
		<rosparam param="x_bounds"> [-5, 200] </rosparam>
		<rosparam param="y_bounds"> [-100, 200] </rosparam>
		<rosparam param="z_bounds"> [-1, 10] </rosparam>
			
		<rosparam param="takeoff_position"> [0, 0, 0.5] </rosparam>
		
		<param name="arm_button" type="int" value="2"/>
		<param name="disarm_button" type="int" value="3"/>

		<param name="A_button" type="int" value="0"/>
		<param name="B_button" type="int" value="1"/>
		<param name="land_button" type="int" value="4"/>
		<param name="send_attractor_button" type="int" value="5"/>

		<param name="x_axis" type="int" value="4"/>
    <param name="y_axis" type="int" value="3"/>
		<param name="z_axis" type="int" value="1"/>
		<param name="yaw_axis" type="int" value="0"/>

		<param name="land_speed" type="double" value="0.2"/>
		<param name="success_radius" type="double" value="0.35"/>
		<param name="sampling_time" type="double" value="0.05"/>
			
		<param name="low_battery_voltage" type="double" value="13.5"/>
		<param name="critical_battery_voltage" type="double" value="12.5"/>
			
		<param name="world_frame_id" type="string" value="$(arg world_frame)"/>
			
	</node>
	
	<!-- .................................................... -->

	<include if="$(arg launch_mavros)" file="$(find mavros)/launch/node.launch">
		<arg name="pluginlists_yaml" value="$(find mavros)/launch/px4_pluginlists.yaml" />
		<arg name="config_yaml" value="$(find mavros)/launch/px4_config.yaml" />

		<arg name="fcu_url" value="/dev/fcu" />
		<arg name="gcs_url" value="" />
		<arg name="tgt_system" value="1" />
		<arg name="tgt_component" value="1" />
		<arg name="log_output" value="screen" />
		<arg name="fcu_protocol" value="v2.0" />
		<arg name="respawn_mavros" value="false" />
	</include>
	
	<!-- .................................................... -->

	<param name="mavros/vision_pose/tf/listen" type="bool" value="true"/>
  <param name="mavros/vision_pose/tf/frame_id" type="string" value="$(arg world_frame)"/>
  <param name="mavros/vision_pose/tf/child_frame_id" type="string" value="$(arg base_frame)"/>
  <param name="mavros/vision_pose/tf/rate_limit" type="double" value="50"/>

  <param name="mavros/local_position/frame_id" value="$(arg world_frame)"/>
  <param name="mavros/global_position/frame_id" value="$(arg world_frame)"/>
  <param name="mavros/global_position/child_frame_id" value="$(arg base_frame)"/>
  <param name="mavros/imu/frame_id" value="$(arg base_frame)"/>	
	
</launch>


<!-- Microsoft Xbox 360 Wired Controller for Linux -->
<!-- Buttons => 0:A, 1:B, 2:X, 3:Y, 4:LB, 5:RB, 6:back, 7:start, 8:power -->
<!-- Axes => 0:L/R Left stick, 1:U/D Left stick, 2:LT, 3:L/R Right stick, 4:U/D Right stick, 5:RT -->  

<!-- F170 Logitech for Linux -->
<!-- Buttons => -->
